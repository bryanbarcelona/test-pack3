default_stages: [pre-commit, pre-push, manual, commit-msg]

repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.9
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
        stages: [pre-commit, pre-push, manual]  # Updated to new names (see below)
      - id: ruff-format
        stages: [pre-commit, pre-push, manual]

  - repo: local
    hooks:
      - id: ty
        name: ty (type checking)
        entry: uvx ty check .
        language: system
        types: [python]
        pass_filenames: false
        stages: [pre-commit, pre-push, manual]

      - id: pytest
        name: pytest
        entry: uv run pytest
        language: system
        types: [python]
        pass_filenames: false
        always_run: true

      - id: pip-audit
        name: pip-audit + cache cleanup
        entry: >-
          uv run python -c "import subprocess, shutil, os; subprocess.run(['uv','run','pip-audit','--skip-editable'], check=False); cache = os.getenv('LOCALAPPDATA') or os.path.expanduser('~/Library/Caches') or os.path.expanduser('~/.cache'); shutil.rmtree(os.path.join(cache,'pip-audit'), ignore_errors=True)"
        language: python
        pass_filenames: false
        always_run: true

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        stages: [pre-commit, pre-push, manual]
      - id: end-of-file-fixer
        stages: [pre-commit, pre-push, manual]
      - id: check-toml
        stages: [pre-commit, pre-push, manual]
      - id: check-yaml
        stages: [pre-commit, pre-push, manual]
      - id: check-added-large-files
        stages: [pre-commit, pre-push, manual]

  - repo: https://github.com/commitizen-tools/commitizen
    rev: v4.10.0
    hooks:
      - id: commitizen
        stages: [commit-msg]

  # # Commitizen hooks (updated to official, non-deprecated setup)
  # - repo: https://github.com/commitizen-tools/commitizen
  #   rev: v4.10.0  # Latest stable as of Nov 2025
  #   hooks:
  #     - id: commitizen
  #       name: Enforce Conventional Commits
  #       entry: cz check
  #       stages: [commit-msg]
  #       language: python
  #       language_version: python3

  #     - id: commitizen-branch
  #       name: Commitizen check branch
  #       entry: cz check
  #       args: [--rev-range, origin/HEAD..HEAD]
  #       always_run: true
  #       pass_filenames: false
  #       language: python
  #       language_version: python3
  #       stages: [pre-push]  # For CI/branch validation



# # .pre-commit-config.yaml
# repos:
#   - repo: https://github.com/astral-sh/ruff-pre-commit
#     rev: v0.6.9
#     hooks:
#       - id: ruff
#         args: [--fix, --exit-non-zero-on-fix]
#       - id: ruff-format

#   - repo: local
#     hooks:
#       # Type checking
#       - id: ty
#         name: ty (type checking)
#         entry: uvx ty check .
#         language: system
#         types: [python]
#         pass_filenames: false

#       # Tests
#       - id: pytest
#         name: pytest
#         entry: uv run pytest
#         language: system
#         types: [python]
#         pass_filenames: false
#         always_run: true

#       # Security audit + cache cleanup
#       - id: pip-audit
#         name: pip-audit + cache cleanup
#         entry: uv run python -c "import subprocess, shutil, os; subprocess.run(['uv','run','pip-audit','--skip-editable'], check=False); cache = os.getenv('LOCALAPPDATA') or os.path.expanduser('~/Library/Caches') or os.path.expanduser('~/.cache'); shutil.rmtree(os.path.join(cache,'pip-audit'), ignore_errors=True)"
#         language: python      # ← slightly better, but system also works now
#         pass_filenames: false
#         always_run: true

#   - repo: https://github.com/pre-commit/pre-commit-hooks
#     rev: v5.0.0
#     hooks:
#       - id: trailing-whitespace
#       - id: end-of-file-fixer
#       - id: check-toml
#       - id: check-yaml
#       - id: check-added-large-files

#   - repo: https://github.com/commitizen-tools/commitizen
#     rev: v3.29.0
#     hooks:
#       # 1. Enforcer – blocks bad messages
#       - id: commitizen
#         entry: cz check --commit-msg-file
#         stages: [commit-msg]          # ← mandatory
#         language: python

#       # 2. Wizard – replaces the editor with the nice UI
#       - id: commitizen-wizard
#         entry: cz commit
#         stages: [commit]              # ← optional but explicit is perfect
#         language: python





# repos:
#   - repo: https://github.com/astral-sh/ruff-pre-commit
#     rev: v0.6.9
#     hooks:
#       - id: ruff
#         args: [--fix, --exit-non-zero-on-fix]
#       - id: ruff-format

#   - repo: local
#     hooks:
#       # ty — type checking
#       - id: ty
#         name: ty (type checking)
#         entry: uvx ty check .
#         language: system
#         types: [python]
#         files: \.py$                # explicitly match .py files anywhere
#         pass_filenames: false

#   # pytest
#   - repo: local
#     hooks:
#       - id: pytest
#         name: pytest
#         entry: uv run pytest
#         language: system
#         types: [python]
#         pass_filenames: false
#         always_run: true

#   # pip-audit – respects your [tool.pip-audit] exclude = ["himmel"] automatically
#   # + cross-platform cache cleanup so it never leaves junk behind
#   - repo: local
#     hooks:
#       - id: pip-audit
#         name: pip-audit + cache cleanup
#         entry: uv run python -c "import subprocess, shutil, os; subprocess.run(['uv','run','pip-audit','--skip-editable'], check=False); cache = os.getenv('LOCALAPPDATA') or os.path.expanduser('~/Library/Caches') or os.path.expanduser('~/.cache'); shutil.rmtree(os.path.join(cache, 'pip-audit'), ignore_errors=True)"
#         language: system
#         pass_filenames: false
#         always_run: true

#   - repo: https://github.com/pre-commit/pre-commit-hooks
#     rev: v5.0.0
#     hooks:
#       - id: trailing-whitespace
#       - id: end-of-file-fixer
#       - id: check-toml
#       - id: check-yaml
#       - id: check-added-large-files
